<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/adminlte.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
          crossorigin="anonymous">
    <link rel="stylesheet" href="css/normalize.css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="js/in-mem-db.js">

    <title>POS</title>
</head>

<body class="hold-transition sidebar-mini">
<div class="wrapper">

    <nav class="main-header navbar navbar-expand bg-white navbar-light border-bottom"
         style="background-color: #3c8dbc !important;">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
            </li>


        </ul>


        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
            <li></li>
        </ul>
    </nav>

    <aside class="main-sidebar sidebar-dark-primary elevation-4" style="min-height: 675px; box-shadow: none;">
        <!-- Brand Logo -->
        <a href="index3.html" class="brand-link"
           style="padding-left: 0px !important;padding-right: 0px !important; background-color: #367fa9;">
            <img src="image/pos%20logo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                 style="opacity: .8;">
            <span class="brand-text font-weight-light">Point Of Sale</span>
        </a>

        <!-- Sidebar -->
        <div class="sidebar" style="padding-left: 0px !important;padding-right: 0px !important;">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex navigation">

                <div class="info " style=" position: relative;left: 50px;">
                    <a href="#" class="d-block">Main Navigation</a>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">

                    <li class="nav-item">
                        <a href="index.html" class="nav-link ">
                            <i class="fas fa-tachometer-alt"></i>
                            <p style="position: relative;left: 10px;">
                                Dashboard

                            </p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="customer.html" class="nav-link ">
                            <i class="fas fa-user"></i>
                            <p style="position: relative;left: 10px;">
                                Manage Customers

                            </p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="item.html" class="nav-link ">
                            <i class="fas fa-list-ul"></i>
                            <p style="position: relative;left: 10px;">
                                Manage Items

                            </p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="placeOrder.html" class="nav-link active">
                            <i class="fas fa-shopping-cart"></i>
                            <p style="position: relative;left: 10px;">
                                Place Order

                            </p>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>
</div>

<div class="content-wrapper ">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-8">
                    <h1 class="m-0 text-dark">Place Order
                        <small style="font-size: 15px;color: #777;"> Select items,quantities and Place Orders </small>
                    </h1>

                </div><!-- /.col -->
                <div class="col-sm-4">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item active">Place Order</li>
                    </ol>
                </div>

            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
        <hr>
    </div>


    <div class="row orders">
        <div id="col1" class="col-md-4">
            <div id="order-details" class="alert alert-warning">
                <div>Order ID: <label id="lblOrderId"></label></div>
                <div>Order Date: <label id="lblOrderDate">2019-02-03</label></div>
            </div>
            <div class="alert alert-primary">
                <div class="form-group">
                    Customer ID:
                    <select id="cmbCustomerID" class="form-control" disabled="disabled">
                        <option selected="" disabled="" hidden="">-Select Customer ID-</option>
                        <option>C001</option>
                        <option>C002</option>
                        <option>C003</option>
                        <option>C004</option>
                        <option>C005</option>
                    </select>
                </div>
                <div>Customer Name: <label id="lblCustomerName"></label></div>
            </div>
            <div id="item-container" class="alert alert-dark">
                <div class="form-group">
                    Item Code:
                    <select id="cmbItemID" class="form-control" disabled="disabled">
                        <option selected="" disabled="" hidden=""> -Select Item ID-</option>
                        <option>I001</option>
                        <option>I002</option>
                        <option>I003</option>
                        <option>I004</option>
                        <option>I005</option>
                        <option>I006</option>
                        <option>I007</option>
                        <option>I008</option>
                        <option>I009</option>
                        <option>I010</option>
                    </select>
                </div>
                <div id="item-details">
                    <div>Item Description: <label id="lblItemDescription"></label></div>
                    <div>Unit Price: <label id="lblUnitPrice"></label></div>
                    <div>Qty. On Hand: <label id="lblQtyOnHand"></label></div>
                </div>
                <div class="form-group">
                    Qty.
                    <input class="form-control" type="number" id="txtQty" disabled="disabled">
                </div>
                <div>
                    <button id="btnAddCart" class="btn btn-warning"><i class="fas fa-cart-plus"></i> Add to Cart
                    </button>
                </div>
            </div>

        </div>
        <div id="col2" class="col-md-8" >
            <div class="alert alert-success" style="height: 535px;">
                <div id="tblContainer" class="table-dark" style="height: 465px;">
                    <table id="tblOrderDetails" class="table table-hover table-dark" >
                        <thead>
                        <tr>
                            <th class="text-center">Item Code</th>
                            <th class="text-center">Description</th>
                            <th class="text-center">Unit Price</th>
                            <th class="text-center">Qty</th>
                            <th class="text-center">Total</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody style="cursor:pointer;">

                        </tbody>
                    </table>
                </div>
                <div>
                    <span id="spnTotal" class="orderDetails-footer" style="font-size: 25px;">Total: <label id="lblTotal">0.0</label></span>
                    <button id="btnPlaceOrder" class="btn btn-primary orderDetails-footer" style="left: 530px;"><i class="fas fa-cart-arrow-down"></i>
                        Place Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row orders">
        <div class="col-12">
            <h3 class="text-center">Order Details</h3>
        </div>
        <table id="tblOrders" class="table table-bordered table-hover">
            <thead>
            <tr>
                <th class="text-center">Order ID</th>
                <th class="text-center">Order Date</th>
                <th class="text-center">Customer ID</th>
                <th class="text-center">Customer Name</th>
                <th class="text-center">Order Total</th>
            </tr>
            </thead>
            <tbody>



            </tbody>
        </table>
    </div>




</div>

<script src="js/date-formatter.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/adminlte.min.js"></script>
<script src="js/in-mem-db.js"></script>
<script src="js/date-formatter.js"></script>

<script>
    var today = new Date();
    var formattedDate = today.format("yyyy-mm-dd");
    $("#lblOrderDate").text(formattedDate);


</script>


<script>


    $("#cmbCustomerID").attr("disabled", '');
    $("#cmbItemId").attr("disabled", '');
    $("#txtQty").attr("disabled", '');

    $("#newOrder").click(function () {
        $("#cmbCustomerID").removeAttr("disabled");
        $("#cmbItemId").removeAttr("disabled");
        $("#txtQty").removeAttr("disabled");

        var ordersCount = $("table tbody tr").length;
        $("#lblOrderId").text(ordersCount);


    });

    $("#cmbCustomerID").prepend("<option selected disabled hidden>-Select Customer ID-</option>");
    for (i = 0; i < CUSTOMERS.length; i++) {
        $("#cmbCustomerID").append("<option>" + CUSTOMERS[i].id + "</option>");
    }

    $("#cmbItemID").prepend("<option selected disabled hidden> -Select Item ID-</option>");
    for (i = 0; i < ITEMS.length; i++) {
        $("#cmbItemId").append("<option>" + ITEMS[i].code + "</option>");
    }

    $("#cmbCustomerID").click(function () {

        for (i = 0; i < CUSTOMERS.length; i++) {
            var selectedCustomerId = $("#cmbCustomerID").find(":selected").text();

            if (selectedCustomerId == CUSTOMERS[i].id) {
                $("#lblCustomerName").text(CUSTOMERS[i].name);


            }

        }
    });

    var qty_onHand = 0;
    var typedQty = 0;
    var selectedIndex = 0;
    $("#cmbItemId").click(function () {


        for (i = 0; i < ITEMS.length; i++) {
            var selectedItemId = $("#cmbItemId").find(":selected").text();


            if (selectedItemId == ITEMS[i].code) {
                $("#lblItemName").text(ITEMS[i].description);
                $("#lblUnitPrice").text(ITEMS[i].unitPrice);
                $("#lblQuantityOnHand").text(ITEMS[i].qtyOnHand);
            }

        }

        qty_onHand = parseInt($("#lblQuantityOnHand").text());
        $("#txtQty").attr("max", qty_onHand);
        $("#txtQty").attr("min", '0');

        $("#txtQty").keyup(function () {
            typedQty = $("#txtQty").val();
            if (typedQty > qty_onHand) {
                $("#txtQty").css("border", '1px solid red');
                return;
            }
            else if (typedQty == "" || typedQty < qty_onHand) {
                $("#txtQty").css("border", 'none');

            }

        });


    });


    $("#btnAddCart").click(function () {

        if ($("#lblCustomerName").text() == "") {
            alert("Please select a Customer");
            return;
        }

        if ($("#lblItemName").text() == "" || $("#lblUnitPrice").text() == "" || $("#lblQuantityOnHand").text() == "") {
            alert("Please select a Item");
            return;
        }

        if ($("#txtQty").val() == "") {
            alert("Please Enter a quantity");
            return;
        }


        if (typedQty > qty_onHand) {
            alert("Please Enter a valid quantity");
            $("#txtQty").focus();
            $("#txtQty").select();
            return;
        }


        var total = parseInt($("#lblUnitPrice").text()) * $("#txtQty").val();
        $("table tbody").append("<tr><td class='text-center' id='itemId'>" + $("#cmbItemID").find(":selected").text() + "</td><td class='text-center' id='description'>" + $("#lblItemName").text() + "</td><td class='text-center' id='unitPrice'>" + $("#lblUnitPrice").text() + "</td><td class='text-center' id='qty'>" + $("#txtQty").val() + "</td><td class='text-center' id='total'>" + total + "</td><td><img src='images/recyclebin.png' width='48px' alt='delete'></td>");
        calculateTotal();
        $("img").mouseover(function () {
            $(this).attr("src", 'images/recyclebin-hover.png');
        });

        $("img").mouseout(function () {
            $(this).attr("src", 'images/recyclebin.png');
        });

        $("img").off("click");
        $("img").click(function (eventData) {

            var deletedItemQty = parseInt($(this).parent().parent().find("#qty").text());
            var deletedItemId = $(this).parent().parent().find("#itemId").text();
            for (i = 0; i < ITEMS.length; i++) {
                if (deletedItemId == ITEMS[i].code) {

                    ITEMS[i].qtyOnHand = ITEMS[i].qtyOnHand + deletedItemQty;
                    $("#lblQtyOnHand").text(ITEMS[i].qtyOnHand);
                }
            }


            $(this).parent().parent().fadeOut(500);

            setTimeout(function () {

                $(this).parent().parent().remove();
                $("#lblTotal").text(calculateTotal());

            }, 600);


            eventData.stopPropagation();
            $("#cmbItemID").val("-Select Item ID-");
            $("#lblItemDescription").text("");
            $("#lblUnitPrice").text("");
            $("#lblQtyOnHand").text("");
            $("#txtQty").val("");

        });

        for (var i = 0; i < ITEMS.length; i++) {
            var selectedItemId = $("#cmbItemID").find(":selected").text();

            if (selectedItemId == ITEMS[i].code) {
                ITEMS[i].qtyOnHand = parseInt($("#lblQtyOnHand").text()) - $("#txtQty").val();
                $("#lblQtyOnHand").text(ITEMS[i].qtyOnHand);
            }
        }


        $("#tblContainer").css("overflow-y", 'scroll');

        $("#tblOrderDetails tbody tr").click(function () {
            $("#cmbItemID").attr("disabled", '');
            $("#btnAddCart").html("<i class='fas fa-cart-plus'></i> Update Cart");

            $("#cmbItemID").val($(this).find("#itemId").text());
            $("#lblItemDescription").text($(this).find("#description").text());
            $("#lblUnitPrice").text($(this).find("#unitPrice").text());

            $("#txtQty").val($(this).find("#qty").text());

            for (var i = 0; i < ITEMS.length; i++) {
                if (ITEMS[i].code == $(this).find("#itemId").text()) {
                    $("#lblQtyOnHand").text(ITEMS[i].qtyOnHand);
                }
            }


        });


    });

    function calculateTotal() {
        var rows = $("#tblOrderDetails tbody tr");
        var total = 0;
        for (var i = 0; i < rows.length; i++) {
            total += parseFloat($(rows[i]).find("td:nth-child(5)").text());
        }
        $("#lblTotal").text(total);
        return total;
    }

</script>

</body>

</html>